apiVersion: v1
kind: Pod
metadata:
  labels:
    app: test-kata-qemu-security-1
  name: test-kata-qemu-security-1
  annotations:
    io.containerd.cri.runtime-handler: kata-qemu-security
spec:
  restartPolicy: Always
  runtimeClassName: kata-qemu-security
  volumes:
  - name: test-shared-data
    emptyDir:
      medium: Memory
  - name: repo-file-v
    hostPath:
      path: /run/kata-containers/repo-file
      type: DirectoryOrCreate
  - name: postgres-storage
    emptyDir: {}
  containers:
  - name: cfs-security-1
    image: hub.confidentialfilesystems.com:4443/cc/coco-trustee:v0.8.0-filesystem-1
    imagePullPolicy: Always
    volumeMounts:
      - name: repo-file-v
        mountPath: /opt/confidential-containers/kbs
      - name: test-shared-data
        mountPath: /data1
        mountPropagation: Bidirectional
    securityContext:
      privileged: true
  - name: ownership-db-1
    image: hub.confidentialfilesystems.com:4443/cc/postgres:12.19-alpine
    imagePullPolicy: Always
    env:
      - name: POSTGRES_DB
        value: postgres
      - name: POSTGRES_USER
        value: postgres
      - name: POSTGRES_PASSWORD
        value: "123456"
    ports:
      - containerPort: 5432
    volumeMounts:
      - name: postgres-storage
        mountPath: /var/lib/postgresql/data
---
apiVersion: v1
kind: Service
metadata:
  name: test-kata-qemu-security-1-svc
spec:
  type: NodePort
  ports:
    - name: https-rest
      port: 11111
      nodePort: 31111
      targetPort: 11111
  selector:
    app: test-kata-qemu-security-1